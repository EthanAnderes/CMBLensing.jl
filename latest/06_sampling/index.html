<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>- Â· CMBLensing.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../assets/cmblensing.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>CMBLensing.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">CMBLensing.jl</a></li><li><a class="toctext" href="../01_lense_a_map/">Lensing a flat map</a></li><li><a class="toctext" href="../02_posterior/">The Lensing Posterior</a></li><li><a class="toctext" href="../03_joint_MAP_example/">Joint maximum a posteriori estimate</a></li><li><a class="toctext" href="../04_from_python/">Calling from Python</a></li><li><a class="toctext" href="../05_field_basics/">Field Basics</a></li><li><a class="toctext" href="../api/">API</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>-</a></li></ul><a class="edit-page" href="https://mybinder.org/v2/gh/marius311/CMBLensing.jl/master?urlpath=lab/tree/06_sampling.ipynb"><img src="https://mybinder.org/badge_logo.svg"/></a></nav><hr/><div id="topbar"><span>-</span><a class="fa fa-bars" href="#"></a></div></header><pre class="language-julia"><code class="language-julia">using Revise
using CMBLensing
using CMBLensing: @ntpack
using Random, Loess, Parameters, Random.DSFMT, Interpolations
using JLD2</code></pre><pre class="language-output"><code class="language-output">â”Œ Info: Recompiling stale cache file /home/marius/.julia/compiled/v1.2/CMBLensing/niPeo.ji for CMBLensing [b60c06c0-7e54-11e8-3788-4bd722d65317]
â”” @ Base loading.jl:1240
â”Œ Warning: Package CMBLensing does not have Setfield in its dependencies:
â”‚ - If you have CMBLensing checked out for development and have
â”‚   added Setfield as a dependency but haven&#39;t updated your primary
â”‚   environment&#39;s manifest file, try `Pkg.resolve()`.
â”‚ - Otherwise you may need to report an issue with CMBLensing
â”” Loading Setfield into CMBLensing from project dependency, future warnings for CMBLensing are suppressed.
WARNING: Method definition inv(LinearAlgebra.Diagonal{T, V} where V&lt;:AbstractArray{T, 1} where T) in module LinearAlgebra at /home/marius/src/julia-1.2/usr/share/julia/stdlib/v1.2/LinearAlgebra/src/diagonal.jl:496 overwritten in module CMBLensing at /home/marius/work/baylens/src/util.jl:168.
  ** incremental compilation may be fatally broken for this module **

WARNING: Method definition (::Type{CMBLensing.DataSet{Td, TCn, TCf, TCfÌƒ, TCÏ•, TCnÌ‚, TBÌ‚, TM, TB, TD, TG, TP} where TP where TG where TD where TB where TM where TBÌ‚ where TCnÌ‚ where TCÏ• where TCfÌƒ where TCf where TCn where Td})(CMBLensing.DataSet{Td, TCn, TCf, TCfÌƒ, TCÏ•, TCnÌ‚, TBÌ‚, TM, TB, TD, TG, TP} where TP where TG where TD where TB where TM where TBÌ‚ where TCnÌ‚ where TCÏ• where TCfÌƒ where TCf where TCn where Td) in module CMBLensing at /home/marius/.julia/packages/Parameters/NholY/src/Parameters.jl:526 overwritten at /home/marius/work/baylens/src/likelihood.jl:52.
  ** incremental compilation may be fatally broken for this module **

WARNING: Method definition Type(Any, Type{CMBLensing.DataSet{Td, TCn, TCf, TCfÌƒ, TCÏ•, TCnÌ‚, TBÌ‚, TM, TB, TD, TG, TP} where TP where TG where TD where TB where TM where TBÌ‚ where TCnÌ‚ where TCÏ• where TCfÌƒ where TCf where TCn where Td}, CMBLensing.DataSet{Td, TCn, TCf, TCfÌƒ, TCÏ•, TCnÌ‚, TBÌ‚, TM, TB, TD, TG, TP} where TP where TG where TD where TB where TM where TBÌ‚ where TCnÌ‚ where TCÏ• where TCfÌƒ where TCf where TCn where Td) in module CMBLensing overwritten.
  ** incremental compilation may be fatally broken for this module **</code></pre><pre class="language-julia"><code class="language-julia">rfid = 0.1
Câ„“ = camb(r=rfid);</code></pre><pre class="language-julia"><code class="language-julia">@unpack f, fÌƒ, Ï•, ds, dsâ‚€ = load_sim_dataset(
    seed  = 0,
    rfid = rfid,
    Câ„“ = Câ„“,
    Î¸pix = 3,
    Nside = 256,
    use = :P,
    T = Float32,
    Î¼KarcminT = 10/âˆš2,
)
@unpack Cf, CÏ• = dsâ‚€;</code></pre><pre class="language-julia"><code class="language-julia"># mixing matrices
ÏƒÂ²len=deg2rad(5/60)^2
NÏ• = nan2zero.(Ï•qe(dsâ‚€)[2])/2
ds = DataSet(ds,
    G = ParamDependentOp(let SN=CÏ•/NÏ•, Gâ‚€=sqrt(1+2/SN)
        (;AÏ•=1, _...)-&gt; @. sqrt(1+2/(AÏ•*SN))/Gâ‚€
    end),
    D = (@. nan2zero(sqrt(1 + 2/(Cf/(ds.CnÌ‚+ÏƒÂ²len))))),
);</code></pre><pre class="language-julia"><code class="language-julia">sample_joint(
    ds,
    Câ„“ = Câ„“,
    Î¸range = (AÏ•=range(0.5, 1.9, length=25),),
    Î¸start = (AÏ•=1,),
    symp_kwargs = (N=25, Ïµ=0.02),
    nsamps_per_chain = 10,
    nchains = 1, 
    pmap = map,
    nchunk = 2,
    nsavemaps = 10,
    nburnin_always_accept = Inf,
    nburnin_fixÎ¸ = 0,
    metadata = (@ntpack f fÌƒ Ï• dsâ‚€),
    progress = :summary,
    filename = &quot;testchain.jld2&quot;
);</code></pre><pre class="language-output"><code class="language-output">[32mGibbs chain: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| Time: 0:05:22[39m</code></pre><pre class="language-julia"><code class="language-julia">@load &quot;testchain.jld2&quot; </code></pre><pre class="language-output"><code class="language-output">2-element Array{Symbol,1}:
 :chains
 :rundat</code></pre><pre class="language-julia"><code class="language-julia">using Statistics</code></pre><pre class="language-julia"><code class="language-julia">getindex.(chains[1][2:end],:timing)</code></pre><pre class="language-output"><code class="language-output">10-element Array{NamedTuple{(:f, :Î¸, :Ï•),Tuple{Float64,Float64,Float64}},1}:
 (f = 3.115016167, Î¸ = 8.954657676, Ï• = 27.103998331) 
 (f = 0.96117215, Î¸ = 9.723460596, Ï• = 20.927602568)  
 (f = 0.716426248, Î¸ = 9.267559107, Ï• = 19.746085108) 
 (f = 0.634769225, Î¸ = 8.661115741, Ï• = 19.175055979) 
 (f = 0.62653508, Î¸ = 8.689044008, Ï• = 20.336935978)  
 (f = 1.265916839, Î¸ = 10.242237773, Ï• = 19.286341166)
 (f = 1.010267911, Î¸ = 9.267745122, Ï• = 20.404541676) 
 (f = 0.835300153, Î¸ = 8.484976122, Ï• = 22.227946742) 
 (f = 0.647691704, Î¸ = 8.461052793, Ï• = 22.776909722) 
 (f = 0.578629753, Î¸ = 8.642342834, Ï• = 21.026899381)</code></pre><pre class="language-julia"><code class="language-julia">plot([rundat[:metadata].Ï• mean(getindex.(filter(s-&gt;haskey(s,:Ï•),chains[1]),:Ï•))])</code></pre><p><img src="../06_sampling_files/06_sampling_8_0.png" alt="png"/></p><pre class="language-output"><code class="language-output">(PyPlot.Figure(PyObject &lt;Figure size 1120x400 with 4 Axes&gt;), PyCall.PyObject[PyObject &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f6cb1b65080&gt; PyObject &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f6cb1b24908&gt;], Symbol[:Tx])</code></pre><pre class="language-julia"><code class="language-julia">plot(first.(getindex.(chains[1],:Î¸)))</code></pre><p><img src="../06_sampling_files/06_sampling_9_0.png" alt="png"/></p><pre class="language-output"><code class="language-output">1-element Array{PyCall.PyObject,1}:
 PyObject &lt;matplotlib.lines.Line2D object at 0x7f6c96fe71d0&gt;</code></pre><footer><hr/></footer></article></body></html>
